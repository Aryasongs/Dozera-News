<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover">
    <title>Dozera News - New York's Premier News Source</title>
    <meta name="description" content="Stay informed with Dozera News - your trusted source for New York politics, business, sports, and local news.">
    <meta name="keywords" content="New York news, NYC news, politics, business, sports, local news">
    <meta name="author" content="Dozera News">
    <meta property="og:title" content="Dozera News - New York's Premier News Source">
    <meta property="og:description" content="Stay informed with the latest news from New York">
    <meta property="og:type" content="website">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { 
            user-select: none; 
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        html, body { 
            zoom: 1 !important; 
            -webkit-text-size-adjust: 100% !important;
            -ms-text-size-adjust: 100% !important;
            -moz-text-size-adjust: 100% !important;
            text-size-adjust: 100% !important;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        body {
            touch-action: pan-y !important;
            -ms-touch-action: pan-y !important;
        }
        .secret-admin-trigger {
            position: fixed;
            top: 0;
            left: 0;
            width: 30px;
            height: 30px;
            opacity: 0;
            cursor: pointer;
            z-index: 1000;
        }
        .verified-badge { color: #1DA1F2; }
        .news-card:hover { transform: translateY(-2px); }
        .provider-btn:hover { transform: scale(1.05); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .fullscreen-article {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 9999;
            overflow-y: auto;
        }
        .user-score {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        .notification-dot {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-active { background: #10b981; }
        .status-pending { background: #f59e0b; }
        .status-suspended { background: #ef4444; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Secret Admin Trigger (invisible) -->
    <div class="secret-admin-trigger" onclick="handleSecretClick()"></div>

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center cursor-pointer" onclick="showHome()">
                        <img id="siteLogo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%231e40af'/%3E%3Ctext x='50' y='60' text-anchor='middle' fill='white' font-size='40' font-weight='bold'%3ED%3C/text%3E%3C/svg%3E" alt="Logo" class="w-10 h-10 mr-3">
                        <div>
                            <h1 id="siteTitle" class="text-3xl font-bold text-blue-900">Dozera News</h1>
                            <span id="siteTagline" class="text-sm text-gray-600 hidden md:block">New York's Premier News Source</span>
                        </div>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6" id="mainNav">
                    <a href="#" onclick="showCategory('politics')" class="text-gray-700 hover:text-blue-600 font-medium">Politics</a>
                    <a href="#" onclick="showCategory('business')" class="text-gray-700 hover:text-blue-600 font-medium">Business</a>
                    <a href="#" onclick="showCategory('sports')" class="text-gray-700 hover:text-blue-600 font-medium">Sports</a>
                    <a href="#" onclick="showCategory('local')" class="text-gray-700 hover:text-blue-600 font-medium">Local</a>
                    <a href="#" onclick="showCategory('tech')" class="text-gray-700 hover:text-blue-600 font-medium">Tech</a>
                    <a href="#" onclick="showPage('about')" class="text-gray-700 hover:text-blue-600 font-medium">About</a>
                </nav>
                <div class="flex items-center space-x-4">
                    <div id="userActions" class="hidden flex items-center space-x-3">
                        <div class="relative">
                            <button onclick="showNotifications()" class="text-gray-600 hover:text-blue-600">
                                <i class="fas fa-bell text-xl"></i>
                                <span id="notificationDot" class="notification-dot hidden"></span>
                            </button>
                        </div>
                        <button onclick="showCreateArticle()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            <i class="fas fa-plus mr-2"></i>Write
                        </button>
                        <div class="relative">
                            <button onclick="toggleUserMenu()" class="flex items-center space-x-2 text-gray-700 hover:text-blue-600">
                                <div id="userAvatar" class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-sm"></div>
                                <span id="userDisplayName" class="hidden md:block"></span>
                                <span id="userScore" class="user-score text-sm"></span>
                                <span id="userVerified" class="verified-badge hidden"><i class="fas fa-check-circle"></i></span>
                            </button>
                            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50">
                                <a href="#" onclick="showProfile()" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user mr-2"></i>Profile
                                </a>
                                <a href="#" onclick="showMyArticles()" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-newspaper mr-2"></i>My Articles
                                </a>
                                <a href="#" onclick="showSettings()" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-cog mr-2"></i>Settings
                                </a>
                                <hr class="my-2">
                                <a href="#" onclick="logout()" class="block px-4 py-2 text-red-600 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </a>
                            </div>
                        </div>
                    </div>
                    <div id="authButtons" class="flex items-center space-x-3">
                        <button onclick="showLoginModal()" class="text-blue-600 hover:text-blue-800 font-medium">Login</button>
                        <button onclick="showSignupModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Sign Up</button>
                    </div>
                    <div id="adminStatus" class="hidden">
                        <button onclick="showAdminPanel()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 relative">
                            <i class="fas fa-crown mr-2"></i>Admin
                            <span id="adminNotificationDot" class="notification-dot hidden"></span>
                        </button>
                    </div>
                    <button class="md:hidden" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden pb-4">
                <div class="flex flex-col space-y-2">
                    <a href="#" onclick="showCategory('politics')" class="text-gray-700 hover:text-blue-600 py-2">Politics</a>
                    <a href="#" onclick="showCategory('business')" class="text-gray-700 hover:text-blue-600 py-2">Business</a>
                    <a href="#" onclick="showCategory('sports')" class="text-gray-700 hover:text-blue-600 py-2">Sports</a>
                    <a href="#" onclick="showCategory('local')" class="text-gray-700 hover:text-blue-600 py-2">Local</a>
                    <a href="#" onclick="showCategory('tech')" class="text-gray-700 hover:text-blue-600 py-2">Tech</a>
                    <a href="#" onclick="showPage('about')" class="text-gray-700 hover:text-blue-600 py-2">About</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 overflow-y-auto" style="height: calc(100vh - 80px); position: absolute; top: 80px; left: 0; right: 0;">
        <!-- Home Page -->
        <div id="homePage" class="fade-in">
            <!-- Breaking News Banner -->
            <div id="breakingNews" class="bg-red-600 text-white p-4 rounded-lg mb-8 slide-up hidden">
                <div class="flex items-center">
                    <span class="bg-white text-red-600 px-3 py-1 rounded-full text-sm font-bold mr-4">BREAKING</span>
                    <p id="breakingNewsText" class="text-lg font-medium"></p>
                </div>
            </div>

            <!-- Featured Articles -->
            <section class="mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">Featured Stories</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8" id="featuredArticles">
                    <!-- Featured articles will be loaded here -->
                </div>
            </section>

            <!-- Latest Articles -->
            <section class="mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-6">Latest News</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="latestArticles">
                    <!-- Latest articles will be loaded here -->
                </div>
            </section>
        </div>

        <!-- Category Pages -->
        <div id="categoryPage" class="hidden fade-in">
            <div class="mb-6">
                <button onclick="showHome()" class="text-blue-600 hover:text-blue-800 mb-4">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Home
                </button>
                <h2 id="categoryTitle" class="text-3xl font-bold text-gray-900 mb-2"></h2>
                <p id="categoryDescription" class="text-gray-600"></p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="categoryArticles">
                <!-- Category articles will be loaded here -->
            </div>
        </div>

        <!-- Static Pages -->
        <div id="staticPage" class="hidden fade-in">
            <button onclick="goBack()" class="text-blue-600 hover:text-blue-800 mb-6">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
            <div id="staticPageContent" class="bg-white rounded-lg shadow-lg p-8">
                <!-- Static page content will be loaded here -->
            </div>
        </div>

        <!-- User Profile -->
        <div id="profilePage" class="hidden fade-in">
            <button onclick="goBack()" class="text-blue-600 hover:text-blue-800 mb-6">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
            <div class="bg-white rounded-lg shadow-lg p-8">
                <div id="profileContent">
                    <!-- Profile content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Create Article -->
        <div id="createArticlePage" class="hidden fade-in">
            <button onclick="goBack()" class="text-blue-600 hover:text-blue-800 mb-6">
                <i class="fas fa-arrow-left mr-2"></i>Back
            </button>
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Create New Article</h2>
                <form id="createArticleForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                            <input type="text" id="newArticleTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                            <select id="newArticleCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                                <option value="">Select Category</option>
                                <option value="politics">Politics</option>
                                <option value="business">Business</option>
                                <option value="sports">Sports</option>
                                <option value="local">Local</option>
                                <option value="tech">Tech</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Summary *</label>
                        <textarea id="newArticleSummary" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Brief article summary..." required></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Content *</label>
                        <textarea id="newArticleContent" rows="12" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Write your article content here..." required></textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-paper-plane mr-2"></i>Submit for Review
                        </button>
                        <button type="button" onclick="goBack()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Fullscreen Article View -->
    <div id="fullscreenArticle" class="fullscreen-article hidden">
        <div class="max-w-4xl mx-auto p-8">
            <div class="flex justify-between items-center mb-8">
                <button onclick="closeFullscreenArticle()" class="text-gray-600 hover:text-gray-800">
                    <i class="fas fa-times text-2xl"></i>
                </button>
                <div class="flex items-center space-x-4">
                    <button onclick="shareArticle()" class="text-gray-600 hover:text-blue-600">
                        <i class="fas fa-share text-xl"></i>
                    </button>
                    <button onclick="bookmarkArticle()" class="text-gray-600 hover:text-yellow-600">
                        <i class="fas fa-bookmark text-xl"></i>
                    </button>
                </div>
            </div>
            <article id="fullscreenArticleContent">
                <!-- Article content will be loaded here -->
            </article>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Welcome Back</h3>
                <p class="text-gray-600">Sign in to your account</p>
            </div>

            <div class="space-y-3">
                <button onclick="signInWithProvider('google')" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="w-5 h-5 mr-3">
                    Continue with Google
                </button>
                <button onclick="signInWithProvider('github')" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <i class="fab fa-github text-xl mr-3"></i>
                    Continue with GitHub
                </button>
                <button onclick="signInWithProvider('twitter')" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <i class="fab fa-twitter text-xl mr-3 text-blue-400"></i>
                    Continue with Twitter
                </button>
                <button onclick="showEmailLogin()" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <i class="fas fa-envelope text-xl mr-3 text-gray-600"></i>
                    Continue with Email
                </button>
                <button onclick="signInWithProvider('phone')" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <i class="fas fa-phone text-xl mr-3 text-green-600"></i>
                    Continue with Phone
                </button>
                <button onclick="signInWithProvider('anonymous')" class="provider-btn w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-all">
                    <i class="fas fa-user-secret text-xl mr-3 text-purple-600"></i>
                    Continue as Guest
                </button>
            </div>

            <div id="emailLoginForm" class="hidden mt-6">
                <div class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <button onclick="signInWithEmail()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">Sign In</button>
                    <button onclick="hideEmailLogin()" class="w-full text-blue-600 hover:text-blue-800">← Back to providers</button>
                </div>
            </div>

            <div class="text-center mt-6">
                <p class="text-gray-600">Don't have an account? 
                    <button onclick="switchToSignup()" class="text-blue-600 hover:text-blue-800 font-medium">Sign up</button>
                </p>
            </div>

            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Admin Access Modal -->
    <div id="adminAccessModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">Admin Access</h3>
                <p class="text-gray-600">Enter admin access code</p>
            </div>

            <div class="mb-6">
                <input type="password" id="adminAccessCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center text-2xl tracking-widest" placeholder="••••••••" maxlength="8">
                <button onclick="verifyAdminCode()" class="w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 mt-4">
                    <i class="fas fa-crown mr-2"></i>Access Admin Panel
                </button>
            </div>

            <button onclick="closeAdminAccessModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
        <div class="min-h-screen">
            <!-- Admin Header -->
            <header class="bg-gray-900 text-white p-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-2xl font-bold">
                        <i class="fas fa-crown mr-2"></i>Admin Dashboard
                    </h2>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button onclick="showAdminNotifications()" class="text-white hover:text-yellow-400">
                                <i class="fas fa-bell text-xl"></i>
                                <span id="adminNotificationCount" class="notification-dot hidden"></span>
                            </button>
                        </div>
                        <span id="adminUserInfo" class="text-sm"></span>
                        <button onclick="closeAdminPanel()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg">
                            <i class="fas fa-eye mr-2"></i>View Site
                        </button>
                        <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex">
                <!-- Admin Sidebar -->
                <nav class="w-64 bg-gray-800 text-white min-h-screen p-4">
                    <ul class="space-y-2">
                        <li><a href="#" onclick="showAdminSection('dashboard')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700 bg-gray-700"><i class="fas fa-tachometer-alt mr-2"></i>Dashboard</a></li>
                        <li><a href="#" onclick="showAdminSection('articles')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-newspaper mr-2"></i>Articles</a></li>
                        <li><a href="#" onclick="showAdminSection('users')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-users mr-2"></i>Users</a></li>
                        <li><a href="#" onclick="showAdminSection('requests')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-clipboard-list mr-2"></i>Requests <span id="requestCount" class="bg-red-600 text-white text-xs px-2 py-1 rounded-full ml-2">0</span></a></li>
                        <li><a href="#" onclick="showAdminSection('analytics')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-chart-bar mr-2"></i>Analytics</a></li>
                        <li><a href="#" onclick="showAdminSection('site')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-cog mr-2"></i>Site Settings</a></li>
                        <li><a href="#" onclick="showAdminSection('pages')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-file-alt mr-2"></i>Pages</a></li>
                        <li><a href="#" onclick="showAdminSection('menu')" class="admin-nav-link block px-4 py-2 rounded hover:bg-gray-700"><i class="fas fa-bars mr-2"></i>Menu</a></li>
                    </ul>
                </nav>

                <!-- Admin Content -->
                <main class="flex-1 p-6 bg-gray-100">
                    <!-- Dashboard -->
                    <div id="adminDashboard" class="admin-section">
                        <h3 class="text-2xl font-bold mb-6">Dashboard Overview</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center">
                                    <i class="fas fa-newspaper text-blue-600 text-3xl mr-4"></i>
                                    <div>
                                        <h4 class="text-xl font-bold text-gray-900">Articles</h4>
                                        <p class="text-gray-600" id="totalArticles">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center">
                                    <i class="fas fa-users text-green-600 text-3xl mr-4"></i>
                                    <div>
                                        <h4 class="text-xl font-bold text-gray-900">Users</h4>
                                        <p class="text-gray-600" id="totalUsers">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center">
                                    <i class="fas fa-clock text-yellow-600 text-3xl mr-4"></i>
                                    <div>
                                        <h4 class="text-xl font-bold text-gray-900">Pending</h4>
                                        <p class="text-gray-600" id="pendingArticles">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow">
                                <div class="flex items-center">
                                    <i class="fas fa-eye text-purple-600 text-3xl mr-4"></i>
                                    <div>
                                        <h4 class="text-xl font-bold text-gray-900">Views</h4>
                                        <p class="text-gray-600">Coming Soon</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Real-time Activity Feed -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h4 class="text-xl font-bold mb-4">Real-time Activity</h4>
                            <div id="activityFeed" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Activity items will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Articles Management -->
                    <div id="adminArticles" class="admin-section hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold">Articles Management</h3>
                            <button onclick="showAdminArticleEditor()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-plus mr-2"></i>New Article
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow overflow-hidden">
                            <div class="p-4 border-b">
                                <div class="flex space-x-4">
                                    <select id="articleStatusFilter" onchange="filterArticles()" class="px-3 py-2 border rounded-lg">
                                        <option value="">All Status</option>
                                        <option value="published">Published</option>
                                        <option value="pending">Pending</option>
                                        <option value="draft">Draft</option>
                                    </select>
                                    <select id="articleCategoryFilter" onchange="filterArticles()" class="px-3 py-2 border rounded-lg">
                                        <option value="">All Categories</option>
                                        <option value="politics">Politics</option>
                                        <option value="business">Business</option>
                                        <option value="sports">Sports</option>
                                        <option value="local">Local</option>
                                        <option value="tech">Tech</option>
                                    </select>
                                </div>
                            </div>
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Article</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Author</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="adminArticlesTable" class="divide-y divide-gray-200">
                                    <!-- Articles will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Users Management -->
                    <div id="adminUsers" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">Users Management</h3>
                        <div class="bg-white rounded-lg shadow overflow-hidden">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">User</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Joined</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable" class="divide-y divide-gray-200">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Requests Management -->
                    <div id="adminRequests" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">User Requests</h3>
                        <div class="space-y-4" id="requestsList">
                            <!-- Requests will be loaded here -->
                        </div>
                    </div>

                    <!-- Site Settings -->
                    <div id="adminSite" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">Site Settings</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white rounded-lg shadow p-6">
                                <h4 class="text-lg font-bold mb-4">General Settings</h4>
                                <form id="siteSettingsForm" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Site Title</label>
                                        <input type="text" id="settingSiteTitle" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="Dozera News">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tagline</label>
                                        <input type="text" id="settingSiteTagline" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="New York's Premier News Source">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Logo URL</label>
                                        <input type="url" id="settingSiteLogo" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                        Save Settings
                                    </button>
                                </form>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow p-6">
                                <h4 class="text-lg font-bold mb-4">SEO Settings</h4>
                                <form id="seoSettingsForm" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Meta Description</label>
                                        <textarea id="settingMetaDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">Stay informed with Dozera News - your trusted source for New York politics, business, sports, and local news.</textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Keywords</label>
                                        <input type="text" id="settingKeywords" class="w-full px-4 py-2 border border-gray-300 rounded-lg" value="New York news, NYC news, politics, business, sports, local news">
                                    </div>
                                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                        Update SEO
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Other admin sections would be implemented similarly -->
                    <div id="adminAnalytics" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">Analytics</h3>
                        <p class="text-gray-600">Analytics dashboard coming soon...</p>
                    </div>

                    <div id="adminPages" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">Pages Management</h3>
                        <p class="text-gray-600">Pages management coming soon...</p>
                    </div>

                    <div id="adminMenu" class="admin-section hidden">
                        <h3 class="text-2xl font-bold mb-6">Menu Management</h3>
                        <p class="text-gray-600">Menu management coming soon...</p>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Custom Alert System -->
    <div id="customAlert" class="fixed top-4 right-4 z-50 hidden">
        <div id="alertContent" class="max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden">
            <div class="p-4">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <i id="alertIcon" class="text-2xl"></i>
                    </div>
                    <div class="ml-3 w-0 flex-1 pt-0.5">
                        <p id="alertMessage" class="text-sm font-medium text-gray-900"></p>
                    </div>
                    <div class="ml-4 flex-shrink-0 flex">
                        <button onclick="hideCustomAlert()" class="bg-white rounded-md inline-flex text-gray-400 hover:text-gray-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Confirmation Dialog -->
    <div id="confirmDialog" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 slide-up">
            <div class="text-center mb-6">
                <i id="confirmIcon" class="text-4xl mb-4"></i>
                <h3 id="confirmTitle" class="text-xl font-bold text-gray-900 mb-2"></h3>
                <p id="confirmMessage" class="text-gray-600"></p>
            </div>
            <div class="flex space-x-4">
                <button id="confirmCancel" onclick="hideConfirmDialog()" class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                    Cancel
                </button>
                <button id="confirmOk" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-700">Loading...</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Dozera News</h3>
                    <p class="text-gray-400">New York's premier source for breaking news, politics, business, and local stories.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Categories</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" onclick="showCategory('politics')" class="hover:text-white">Politics</a></li>
                        <li><a href="#" onclick="showCategory('business')" class="hover:text-white">Business</a></li>
                        <li><a href="#" onclick="showCategory('sports')" class="hover:text-white">Sports</a></li>
                        <li><a href="#" onclick="showCategory('local')" class="hover:text-white">Local</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Legal</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" onclick="showPage('privacy')" class="hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" onclick="showPage('terms')" class="hover:text-white">Terms of Service</a></li>
                        <li><a href="#" onclick="showPage('community')" class="hover:text-white">Community Guidelines</a></li>
                        <li><a href="#" onclick="showPage('careers')" class="hover:text-white">Careers</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Follow Us</h4>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white text-xl"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Dozera News. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA2aDGTKSbkeFnG5aAPPVGkGk3-JOsfbDQ",
            authDomain: "dozeranews.firebaseapp.com",
            projectId: "dozeranews",
            storageBucket: "dozeranews.firebasestorage.app",
            messagingSenderId: "162732208376",
            appId: "1:162732208376:web:6a0fe4df447b2e9a090b0d"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let isAdmin = false;
        let secretClickCount = 0;
        let currentView = 'home';
        let currentCategory = '';
        let currentArticle = null;
        let userPermissions = {
            canCreateArticles: false,
            canEditArticles: false,
            isVerified: false,
            isSuspended: false
        };

        // Global data arrays (will be populated from Firestore)
        let newsArticles = [];
        let allUsers = [];
        let userPermissions = {};
        let pendingRequests = [];

        const staticPages = {
            about: {
                title: 'About Dozera News',
                content: `
                    <h1 class="text-3xl font-bold mb-6">About Dozera News</h1>
                    <p class="mb-4">Dozera News is New York's premier digital news platform, dedicated to delivering accurate, timely, and comprehensive coverage of the stories that matter most to New Yorkers.</p>
                    <p class="mb-4">Founded with the mission to inform, engage, and empower our community, we cover everything from breaking news and politics to business, sports, and local events.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Our Mission</h2>
                    <p class="mb-4">To provide New Yorkers with the information they need to make informed decisions about their lives, their community, and their future.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Contact Us</h2>
                    <p class="mb-2"><strong>Email:</strong> contact@dozeranews.com</p>
                    <p class="mb-2"><strong>Phone:</strong> (555) 123-4567</p>
                    <p class="mb-2"><strong>Address:</strong> 123 News Street, New York, NY 10001</p>
                `
            },
            privacy: {
                title: 'Privacy Policy',
                content: `
                    <h1 class="text-3xl font-bold mb-6">Privacy Policy</h1>
                    <p class="mb-4"><strong>Last updated:</strong> ${new Date().toLocaleDateString()}</p>
                    <p class="mb-4">At Dozera News, we take your privacy seriously. This Privacy Policy explains how we collect, use, and protect your information.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Information We Collect</h2>
                    <p class="mb-4">We collect information you provide directly to us, such as when you create an account, subscribe to our newsletter, or contact us.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">How We Use Your Information</h2>
                    <p class="mb-4">We use the information we collect to provide, maintain, and improve our services, communicate with you, and comply with legal obligations.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Contact Us</h2>
                    <p class="mb-4">If you have any questions about this Privacy Policy, please contact us at privacy@dozeranews.com.</p>
                `
            },
            terms: {
                title: 'Terms of Service',
                content: `
                    <h1 class="text-3xl font-bold mb-6">Terms of Service</h1>
                    <p class="mb-4"><strong>Last updated:</strong> ${new Date().toLocaleDateString()}</p>
                    <p class="mb-4">Welcome to Dozera News. These Terms of Service govern your use of our website and services.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Acceptance of Terms</h2>
                    <p class="mb-4">By accessing and using this website, you accept and agree to be bound by the terms and provision of this agreement.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">User Conduct</h2>
                    <p class="mb-4">You agree to use our services only for lawful purposes and in accordance with these Terms of Service.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Contact Information</h2>
                    <p class="mb-4">For questions about these Terms of Service, contact us at legal@dozeranews.com.</p>
                `
            },
            community: {
                title: 'Community Guidelines',
                content: `
                    <h1 class="text-3xl font-bold mb-6">Community Guidelines</h1>
                    <p class="mb-4">Our community guidelines help ensure Dozera News remains a safe and welcoming space for all users.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Be Respectful</h2>
                    <p class="mb-4">Treat all community members with respect and courtesy. Personal attacks, harassment, and discriminatory language are not tolerated.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Stay On Topic</h2>
                    <p class="mb-4">Keep discussions relevant to the article or topic at hand. Off-topic comments may be removed.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">No Spam or Self-Promotion</h2>
                    <p class="mb-4">Avoid posting spam, excessive self-promotion, or repetitive content.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Report Violations</h2>
                    <p class="mb-4">If you see content that violates these guidelines, please report it to our moderation team.</p>
                `
            },
            careers: {
                title: 'Careers',
                content: `
                    <h1 class="text-3xl font-bold mb-6">Join Our Team</h1>
                    <p class="mb-4">Dozera News is always looking for talented individuals to join our growing team.</p>
                    <h2 class="text-2xl font-bold mb-4 mt-8">Current Openings</h2>
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-2">Senior Reporter</h3>
                        <p class="mb-2">We're seeking an experienced reporter to cover New York politics and government.</p>
                        <p class="text-sm text-gray-600 mb-4">Full-time • New York, NY</p>
                    </div>
                    <div class="mb-6">
                        <h3 class="text-xl font-bold mb-2">Digital Editor</h3>
                        <p class="mb-2">Join our editorial team to help shape our digital content strategy.</p>
                        <p class="text-sm text-gray-600 mb-4">Full-time • Remote</p>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 mt-8">How to Apply</h2>
                    <p class="mb-4">Send your resume and cover letter to careers@dozeranews.com. Include the position title in the subject line.</p>
                `
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadFirestoreData();
            updateURL();
            
            // Auth state observer
            auth.onAuthStateChanged(function(user) {
                currentUser = user;
                if (user) {
                    checkUserPermissions(user);
                    updateUserUI();
                    loadUserSpecificData();
                } else {
                    resetUserUI();
                }
            });

            // Handle browser back/forward
            window.addEventListener('popstate', function(event) {
                if (event.state) {
                    handleRouting(event.state.path);
                }
            });

            // Handle initial route
            handleRouting(window.location.hash);
        });

        // Routing system
        function updateURL(path = '') {
            const newPath = path || getCurrentPath();
            window.history.pushState({ path: newPath }, '', newPath);
        }

        function getCurrentPath() {
            if (currentView === 'home') return '#/';
            if (currentView === 'category') return `#/category/${currentCategory}`;
            if (currentView === 'article' && currentArticle) return `#/article/${currentArticle.slug}`;
            if (currentView === 'static') return `#/page/${currentPage}`;
            return '#/';
        }

        function handleRouting(path) {
            if (!path || path === '#/' || path === '') {
                showHome();
            } else if (path.startsWith('#/category/')) {
                const category = path.split('/')[2];
                showCategory(category);
            } else if (path.startsWith('#/article/')) {
                const slug = path.split('/')[2];
                const article = sampleArticles.find(a => a.slug === slug);
                if (article) {
                    showFullscreenArticle(article.id);
                }
            } else if (path.startsWith('#/page/')) {
                const page = path.split('/')[2];
                showPage(page);
            }
        }

        // Secret admin access
        function handleSecretClick() {
            secretClickCount++;
            if (secretClickCount >= 5) {
                showAdminAccessModal();
                secretClickCount = 0;
            }
            setTimeout(() => { secretClickCount = 0; }, 3000);
        }

        function showAdminAccessModal() {
            document.getElementById('adminAccessModal').classList.remove('hidden');
            document.getElementById('adminAccessCode').focus();
        }

        function closeAdminAccessModal() {
            document.getElementById('adminAccessModal').classList.add('hidden');
            document.getElementById('adminAccessCode').value = '';
        }

        function verifyAdminCode() {
            const code = document.getElementById('adminAccessCode').value;
            if (code === '20060202') {
                closeAdminAccessModal();
                if (currentUser) {
                    setAdminStatus(true);
                } else {
                    alert('Please login first to access admin panel');
                    showLoginModal();
                }
            } else {
                alert('Invalid access code');
                document.getElementById('adminAccessCode').value = '';
            }
        }

        // Authentication functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            hideEmailLogin();
        }

        function showSignupModal() {
            showLoginModal(); // Same modal, different providers
        }

        function switchToSignup() {
            // In a real app, this would show signup-specific UI
            showEmailLogin();
        }

        function showEmailLogin() {
            document.getElementById('emailLoginForm').classList.remove('hidden');
        }

        function hideEmailLogin() {
            document.getElementById('emailLoginForm').classList.add('hidden');
        }

        async function signInWithProvider(provider) {
            try {
                let result;
                switch(provider) {
                    case 'google':
                        const googleProvider = new firebase.auth.GoogleAuthProvider();
                        result = await auth.signInWithPopup(googleProvider);
                        break;
                    case 'github':
                        const githubProvider = new firebase.auth.GithubAuthProvider();
                        result = await auth.signInWithPopup(githubProvider);
                        break;
                    case 'twitter':
                        const twitterProvider = new firebase.auth.TwitterAuthProvider();
                        result = await auth.signInWithPopup(twitterProvider);
                        break;
                    case 'anonymous':
                        result = await auth.signInAnonymously();
                        break;
                    case 'phone':
                        alert('Phone authentication requires additional setup. Please use email for now.');
                        return;
                }
                
                if (result.user) {
                    await createUserProfile(result.user);
                    closeLoginModal();
                }
            } catch (error) {
                console.error('Authentication error:', error);
                alert('Authentication failed: ' + error.message);
            }
        }

        async function signInWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const result = await auth.signInWithEmailAndPassword(email, password);
                if (result.user) {
                    closeLoginModal();
                }
            } catch (error) {
                // Try to create account if it doesn't exist
                try {
                    const createResult = await auth.createUserWithEmailAndPassword(email, password);
                    if (createResult.user) {
                        await createUserProfile(createResult.user);
                        closeLoginModal();
                    }
                } catch (createError) {
                    console.error('Email authentication error:', createError);
                    alert('Authentication failed: ' + createError.message);
                }
            }
        }

        // Firestore data loading functions
        async function loadFirestoreData() {
            try {
                showLoading();
                
                // Load published news articles
                const newsSnapshot = await db.collection('news')
                    .where('status', '==', 'published')
                    .orderBy('date', 'desc')
                    .get();
                
                newsArticles = newsSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Load users (public data only)
                const usersSnapshot = await db.collection('users').get();
                allUsers = usersSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                // Load initial content
                loadFeaturedArticles();
                loadLatestArticles();
                
                hideLoading();
            } catch (error) {
                console.error('Error loading Firestore data:', error);
                hideLoading();
                showCustomAlert('Error loading data. Please refresh the page.', 'error');
            }
        }

        async function loadUserSpecificData() {
            if (!currentUser) return;
            
            try {
                // Load pending articles if admin
                if (isAdmin) {
                    const pendingSnapshot = await db.collection('pendingArticles').get();
                    pendingRequests = pendingSnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                }
            } catch (error) {
                console.error('Error loading user-specific data:', error);
            }
        }

        async function createUserProfile(user) {
            try {
                const userProfile = {
                    email: user.email,
                    displayName: user.displayName || user.email?.split('@')[0] || 'Anonymous',
                    score: 100,
                    isVerified: false,
                    status: 'active',
                    joinDate: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('users').doc(user.uid).set(userProfile, { merge: true });
                
                // Create permissions document
                await db.collection('permissions').doc(user.uid).set({
                    canCreateArticles: false,
                    canEditArticles: false,
                    isSuspended: false
                });
                
            } catch (error) {
                console.error('Error creating user profile:', error);
            }
        }

        async function checkUserPermissions(user) {
            try {
                // Check if user has admin custom claim
                const idTokenResult = await user.getIdTokenResult();
                if (idTokenResult.claims.admin) {
                    setAdminStatus(true);
                }
                
                // Load user permissions
                const permissionsDoc = await db.collection('permissions').doc(user.uid).get();
                if (permissionsDoc.exists) {
                    userPermissions = permissionsDoc.data();
                } else {
                    // Create default permissions if they don't exist
                    userPermissions = {
                        canCreateArticles: false,
                        canEditArticles: false,
                        isSuspended: false
                    };
                    await db.collection('permissions').doc(user.uid).set(userPermissions);
                }
                
                // Load user profile data
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    // Update UI with user data
                    if (userData.isVerified) {
                        userPermissions.isVerified = true;
                    }
                }
                
            } catch (error) {
                console.error('Error checking user permissions:', error);
            }
        }

        function setAdminStatus(status) {
            isAdmin = status;
            if (status) {
                document.getElementById('adminStatus').classList.remove('hidden');
                showAdminPanel();
            } else {
                document.getElementById('adminStatus').classList.add('hidden');
            }
        }

        function updateUserUI() {
            if (currentUser) {
                document.getElementById('authButtons').classList.add('hidden');
                document.getElementById('userActions').classList.remove('hidden');
                
                const displayName = currentUser.displayName || currentUser.email?.split('@')[0] || 'User';
                document.getElementById('userDisplayName').textContent = displayName;
                document.getElementById('userAvatar').textContent = displayName.charAt(0).toUpperCase();
                
                // Update user score and verification status
                updateUserScore();
            }
        }

        function resetUserUI() {
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userActions').classList.add('hidden');
            document.getElementById('adminStatus').classList.add('hidden');
            isAdmin = false;
            userPermissions = {
                canCreateArticles: false,
                canEditArticles: false,
                isVerified: false,
                isSuspended: false
            };
        }

        async function updateUserScore() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    document.getElementById('userScore').textContent = `${userData.score || 100}`;
                    
                    if (userData.isVerified) {
                        document.getElementById('userVerified').classList.remove('hidden');
                    }
                }
            } catch (error) {
                console.error('Error updating user score:', error);
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                closeAdminPanel();
                showHome();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Navigation functions
        function showHome() {
            currentView = 'home';
            hideAllPages();
            document.getElementById('homePage').classList.remove('hidden');
            loadFeaturedArticles();
            loadLatestArticles();
            updateURL('#/');
        }

        function showCategory(category) {
            currentView = 'category';
            currentCategory = category;
            hideAllPages();
            document.getElementById('categoryPage').classList.remove('hidden');
            
            const categoryInfo = {
                politics: { title: 'Politics', description: 'Latest political news from Albany, NYC, and Washington' },
                business: { title: 'Business', description: 'Wall Street updates and local business news' },
                sports: { title: 'Sports', description: 'Yankees, Mets, Giants, Jets and all New York sports' },
                local: { title: 'Local News', description: 'Community news and events across New York' },
                tech: { title: 'Technology', description: 'Tech industry news and innovation updates' }
            };
            
            document.getElementById('categoryTitle').textContent = categoryInfo[category].title;
            document.getElementById('categoryDescription').textContent = categoryInfo[category].description;
            
            loadCategoryArticles(category);
            updateURL(`#/category/${category}`);
        }

        function showPage(page) {
            currentView = 'static';
            currentPage = page;
            hideAllPages();
            document.getElementById('staticPage').classList.remove('hidden');
            
            if (staticPages[page]) {
                document.getElementById('staticPageContent').innerHTML = staticPages[page].content;
            }
            updateURL(`#/page/${page}`);
        }

        function showFullscreenArticle(articleId) {
            const article = newsArticles.find(a => a.id === articleId);
            if (!article) return;
            
            currentView = 'article';
            currentArticle = article;
            
            document.getElementById('fullscreenArticle').classList.remove('hidden');
            document.getElementById('fullscreenArticleContent').innerHTML = `
                <div class="mb-6">
                    <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mb-4">
                        ${article.category.charAt(0).toUpperCase() + article.category.slice(1)}
                    </span>
                    ${article.breaking ? '<span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium mb-4 ml-2">Breaking</span>' : ''}
                    ${article.featured ? '<span class="inline-block bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium mb-4 ml-2">Featured</span>' : ''}
                </div>
                <h1 class="text-4xl font-bold text-gray-900 mb-4">${article.title}</h1>
                <div class="flex items-center text-gray-600 mb-6">
                    <span class="mr-4">By ${article.author}</span>
                    <span>${new Date(article.date).toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}</span>
                </div>
                ${article.imageUrl ? `<img src="${article.imageUrl}" alt="${article.title}" class="w-full h-64 object-cover rounded-lg mb-6">` : ''}
                <div class="prose max-w-none text-lg leading-relaxed">
                    ${article.content.split('\n').map(p => p.trim() ? `<p class="mb-6">${p}</p>` : '').join('')}
                </div>
            `;
            
            updateURL(`#/article/${article.slug}`);
        }

        function closeFullscreenArticle() {
            document.getElementById('fullscreenArticle').classList.add('hidden');
            currentView = 'home';
            currentArticle = null;
            showHome();
        }

        function hideAllPages() {
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('categoryPage').classList.add('hidden');
            document.getElementById('staticPage').classList.add('hidden');
            document.getElementById('profilePage').classList.add('hidden');
            document.getElementById('createArticlePage').classList.add('hidden');
        }

        function goBack() {
            if (currentView === 'static' || currentView === 'profile' || currentView === 'create') {
                showHome();
            } else if (currentView === 'category') {
                showHome();
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Article functions

        function loadFeaturedArticles() {
            const featuredArticles = newsArticles.filter(article => article.featured);
            const container = document.getElementById('featuredArticles');
            
            if (featuredArticles.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No featured articles available</div>';
                return;
            }
            
            container.innerHTML = featuredArticles.map(article => createArticleCard(article)).join('');
        }

        function loadLatestArticles() {
            const latestArticles = newsArticles
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 6);
            
            const container = document.getElementById('latestArticles');
            
            if (latestArticles.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No articles available</div>';
                return;
            }
            
            container.innerHTML = latestArticles.map(article => createArticleCard(article)).join('');
        }

        function loadCategoryArticles(category) {
            const categoryArticles = newsArticles.filter(article => article.category === category);
            const container = document.getElementById('categoryArticles');
            
            if (categoryArticles.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No articles in this category</div>';
                return;
            }
            
            container.innerHTML = categoryArticles.map(article => createArticleCard(article)).join('');
        }

        function createArticleCard(article) {
            return `
                <article class="bg-white rounded-lg shadow-md overflow-hidden news-card transition-transform cursor-pointer" onclick="showFullscreenArticle('${article.id}')">
                    ${article.imageUrl ? `<img src="${article.imageUrl}" alt="${article.title}" class="w-full h-48 object-cover">` : ''}
                    <div class="p-6">
                        <div class="flex items-center mb-3">
                            <span class="inline-block bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                ${article.category.charAt(0).toUpperCase() + article.category.slice(1)}
                            </span>
                            ${article.breaking ? '<span class="inline-block bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium ml-2">Breaking</span>' : ''}
                            ${article.featured ? '<span class="inline-block bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium ml-2">Featured</span>' : ''}
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 hover:text-blue-600">${article.title}</h3>
                        <p class="text-gray-600 mb-4">${article.summary}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <span>By ${article.author}</span>
                            <span>${new Date(article.date).toLocaleDateString()}</span>
                        </div>
                    </div>
                </article>
            `;
        }

        // User functions
        function showProfile() {
            currentView = 'profile';
            hideAllPages();
            document.getElementById('profilePage').classList.remove('hidden');
            loadUserProfile();
        }

        function showCreateArticle() {
            if (!currentUser) {
                alert('Please login to create articles');
                showLoginModal();
                return;
            }
            
            if (!userPermissions.canCreateArticles) {
                alert('You need permission to create articles. Please request access from an admin.');
                return;
            }
            
            currentView = 'create';
            hideAllPages();
            document.getElementById('createArticlePage').classList.remove('hidden');
        }

        function loadUserProfile() {
            if (!currentUser) return;
            
            const profileContent = `
                <div class="flex items-center mb-8">
                    <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-2xl mr-6">
                        ${(currentUser.displayName || currentUser.email?.split('@')[0] || 'U').charAt(0).toUpperCase()}
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">${currentUser.displayName || currentUser.email?.split('@')[0] || 'User'}</h2>
                        <p class="text-gray-600">${currentUser.email}</p>
                        <div class="flex items-center mt-2">
                            <span class="user-score text-lg mr-3">Score: 750</span>
                            ${userPermissions.isVerified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>' : ''}
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <h3 class="font-bold text-blue-900">Articles Published</h3>
                        <p class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <h3 class="font-bold text-green-900">Total Views</h3>
                        <p class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <h3 class="font-bold text-purple-900">Reputation</h3>
                        <p class="text-2xl font-bold text-purple-600">750</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-xl font-bold">Account Settings</h3>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <span>Create Articles Permission</span>
                            <span class="${userPermissions.canCreateArticles ? 'text-green-600' : 'text-red-600'}">
                                ${userPermissions.canCreateArticles ? 'Granted' : 'Not Granted'}
                            </span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <span>Edit Articles Permission</span>
                            <span class="${userPermissions.canEditArticles ? 'text-green-600' : 'text-red-600'}">
                                ${userPermissions.canEditArticles ? 'Granted' : 'Not Granted'}
                            </span>
                        </div>
                    </div>
                    
                    ${!userPermissions.canCreateArticles ? `
                        <button onclick="requestPermission('create')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Request Article Creation Permission
                        </button>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('profileContent').innerHTML = profileContent;
        }

        async function requestPermission(type) {
            if (!currentUser) {
                showCustomAlert('Please login first to request permissions', 'warning');
                return;
            }
            
            try {
                showLoading();
                
                const requestData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userDisplayName: currentUser.displayName || currentUser.email?.split('@')[0] || 'Anonymous',
                    type: type,
                    status: 'pending',
                    requestDate: firebase.firestore.FieldValue.serverTimestamp(),
                    message: `User requesting ${type} permission`
                };
                
                // Add to pendingArticles collection (or create a separate requests collection)
                await db.collection('pendingArticles').add({
                    ...requestData,
                    title: `Permission Request: ${type}`,
                    category: 'system',
                    summary: `Permission request from ${requestData.userDisplayName}`,
                    content: requestData.message,
                    isPermissionRequest: true
                });
                
                showCustomAlert('Permission request submitted successfully! An admin will review your request.', 'success');
                hideLoading();
                
            } catch (error) {
                console.error('Error submitting request:', error);
                showCustomAlert('Request submission failed. Please try again later.', 'error');
                hideLoading();
            }
        }

        // Article creation
        document.getElementById('createArticleForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!currentUser || !userPermissions.canCreateArticles) {
                showCustomAlert('You do not have permission to create articles', 'warning');
                return;
            }
            
            const title = document.getElementById('newArticleTitle').value;
            const category = document.getElementById('newArticleCategory').value;
            const summary = document.getElementById('newArticleSummary').value;
            const content = document.getElementById('newArticleContent').value;
            
            const slug = title.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim('-');
            
            const articleData = {
                title,
                category,
                summary,
                content,
                slug,
                author: currentUser.displayName || currentUser.email?.split('@')[0] || 'Anonymous',
                authorId: currentUser.uid,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending',
                featured: false,
                breaking: false,
                imageUrl: ''
            };
            
            try {
                showLoading();
                await db.collection('pendingArticles').add(articleData);
                showCustomAlert('Article submitted for review! An admin will review and publish it.', 'success');
                document.getElementById('createArticleForm').reset();
                showHome();
                hideLoading();
            } catch (error) {
                console.error('Error submitting article:', error);
                showCustomAlert('Error submitting article. Please try again.', 'error');
                hideLoading();
            }
        });

        // Admin Panel Functions
        function showAdminPanel() {
            if (!isAdmin) return;
            document.getElementById('adminPanel').classList.remove('hidden');
            showAdminSection('dashboard');
            loadAdminData();
            startRealTimeUpdates();
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.add('hidden');
        }

        function showAdminSection(section) {
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
            
            // Show selected section
            const sectionElement = document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1));
            if (sectionElement) {
                sectionElement.classList.remove('hidden');
            }
            
            // Update navigation
            document.querySelectorAll('.admin-nav-link').forEach(link => link.classList.remove('bg-gray-700'));
            event.target.classList.add('bg-gray-700');
            
            // Load section-specific data
            switch(section) {
                case 'articles':
                    loadAdminArticles();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
                case 'requests':
                    loadAdminRequests();
                    break;
            }
        }

        async function loadAdminData() {
            try {
                // Load all articles (published and pending)
                const allArticlesSnapshot = await db.collection('news').get();
                const allArticles = allArticlesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const pendingSnapshot = await db.collection('pendingArticles').get();
                const pendingArticles = pendingSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                document.getElementById('totalArticles').textContent = allArticles.length;
                document.getElementById('totalUsers').textContent = allUsers.length;
                document.getElementById('pendingArticles').textContent = pendingArticles.length;
                
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        async function loadAdminArticles() {
            try {
                // Load both published and pending articles
                const publishedSnapshot = await db.collection('news').get();
                const pendingSnapshot = await db.collection('pendingArticles').get();
                
                const allArticles = [
                    ...publishedSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), collection: 'news' })),
                    ...pendingSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), collection: 'pendingArticles' }))
                ];
                
                const tbody = document.getElementById('adminArticlesTable');
                tbody.innerHTML = allArticles.map(article => `
                    <tr>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900">${article.title}</div>
                            <div class="text-sm text-gray-500">${article.category}</div>
                            ${article.isPermissionRequest ? '<span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Permission Request</span>' : ''}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">${article.author || 'System'}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(article.status || 'pending')}">
                                ${article.status || 'pending'}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">${article.date ? new Date(article.date.toDate ? article.date.toDate() : article.date).toLocaleDateString() : 'N/A'}</td>
                        <td class="px-6 py-4 text-sm space-x-2">
                            ${!article.isPermissionRequest ? `
                                <button onclick="approveArticle('${article.id}', '${article.collection}')" class="text-green-600 hover:text-green-800" title="Approve">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button onclick="toggleFeatured('${article.id}', '${article.collection}')" class="text-yellow-600 hover:text-yellow-800" title="Toggle Featured">
                                    <i class="fas fa-star"></i>
                                </button>
                            ` : `
                                <button onclick="approvePermissionRequest('${article.id}', '${article.userId}', '${article.type}')" class="text-green-600 hover:text-green-800" title="Grant Permission">
                                    <i class="fas fa-user-check"></i>
                                </button>
                            `}
                            <button onclick="deleteAdminArticle('${article.id}', '${article.collection}')" class="text-red-600 hover:text-red-800" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading admin articles:', error);
            }
        }

        function loadAdminUsers() {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = allUsers.map(user => `
                <tr>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold mr-3">
                                ${user.displayName ? user.displayName.charAt(0).toUpperCase() : 'U'}
                            </div>
                            <div>
                                <div class="font-medium text-gray-900">${user.displayName || 'Anonymous'}</div>
                                <div class="text-sm text-gray-500">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm">
                        <span class="user-score">${user.score || 100}</span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <span class="status-indicator status-${user.status || 'active'}"></span>
                            <span class="text-sm">${user.status || 'active'}</span>
                            ${user.isVerified ? '<i class="fas fa-check-circle text-blue-500 ml-2"></i>' : ''}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900">${user.joinDate ? new Date(user.joinDate.toDate ? user.joinDate.toDate() : user.joinDate).toLocaleDateString() : 'N/A'}</td>
                    <td class="px-6 py-4 text-sm space-x-2">
                        <button onclick="toggleUserVerification('${user.id}')" class="text-blue-600 hover:text-blue-800" title="Toggle Verification">
                            <i class="fas fa-check-circle"></i>
                        </button>
                        <button onclick="suspendUser('${user.id}')" class="text-red-600 hover:text-red-800" title="Suspend">
                            <i class="fas fa-ban"></i>
                        </button>
                        <button onclick="grantPermission('${user.id}', 'create')" class="text-green-600 hover:text-green-800" title="Grant Create Permission">
                            <i class="fas fa-plus"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function loadAdminRequests() {
            // Load requests from localStorage and sample data
            const storedRequests = JSON.parse(localStorage.getItem('userRequests') || '[]');
            const sampleRequests = [
                {
                    id: '1',
                    userEmail: 'john@example.com',
                    type: 'create',
                    message: 'I would like to contribute articles about local NYC events',
                    status: 'pending',
                    date: new Date().toISOString()
                }
            ];
            
            const allRequests = [...sampleRequests, ...storedRequests];
            
            const container = document.getElementById('requestsList');
            container.innerHTML = allRequests.map(request => `
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-bold text-lg">${request.type.charAt(0).toUpperCase() + request.type.slice(1)} Permission Request</h4>
                            <p class="text-gray-600">From: ${request.userEmail}</p>
                            <p class="text-sm text-gray-500">${new Date(request.date || request.requestDate).toLocaleDateString()}</p>
                        </div>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : request.status === 'approved' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${request.status}
                        </span>
                    </div>
                    <p class="text-gray-700 mb-4">${request.message}</p>
                    ${request.status === 'pending' ? `
                        <div class="flex space-x-2">
                            <button onclick="approveRequest('${request.id}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                <i class="fas fa-check mr-2"></i>Approve
                            </button>
                            <button onclick="rejectRequest('${request.id}')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                <i class="fas fa-times mr-2"></i>Reject
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            const pendingCount = allRequests.filter(r => r.status === 'pending').length;
            document.getElementById('requestCount').textContent = pendingCount;
        }

        function getStatusColor(status) {
            switch(status) {
                case 'published': return 'bg-green-100 text-green-800';
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'draft': return 'bg-gray-100 text-gray-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function startRealTimeUpdates() {
            // Simulate real-time activity feed
            const activities = [
                'New user registered: john@example.com',
                'Article submitted for review: "Local Business Spotlight"',
                'User requested create permission: sarah@example.com',
                'Article published: "NYC Infrastructure Update"'
            ];
            
            const activityFeed = document.getElementById('activityFeed');
            let activityIndex = 0;
            
            setInterval(() => {
                const activity = activities[activityIndex % activities.length];
                const activityElement = document.createElement('div');
                activityElement.className = 'flex items-center p-3 bg-gray-50 rounded-lg';
                activityElement.innerHTML = `
                    <i class="fas fa-circle text-green-500 text-xs mr-3"></i>
                    <span class="text-sm">${activity}</span>
                    <span class="text-xs text-gray-500 ml-auto">${new Date().toLocaleTimeString()}</span>
                `;
                
                activityFeed.insertBefore(activityElement, activityFeed.firstChild);
                
                // Keep only last 10 activities
                while (activityFeed.children.length > 10) {
                    activityFeed.removeChild(activityFeed.lastChild);
                }
                
                activityIndex++;
            }, 10000); // Update every 10 seconds
        }

        // Admin action functions
        async function approveArticle(articleId, collection) {
            showConfirmDialog(
                'Approve Article',
                'Are you sure you want to approve and publish this article?',
                async () => {
                    try {
                        showLoading();
                        
                        if (collection === 'pendingArticles') {
                            // Move from pending to published
                            const pendingDoc = await db.collection('pendingArticles').doc(articleId).get();
                            if (pendingDoc.exists) {
                                const articleData = pendingDoc.data();
                                
                                // Add to news collection
                                await db.collection('news').add({
                                    ...articleData,
                                    status: 'published',
                                    publishedDate: firebase.firestore.FieldValue.serverTimestamp()
                                });
                                
                                // Remove from pending
                                await db.collection('pendingArticles').doc(articleId).delete();
                            }
                        } else {
                            // Update existing article
                            await db.collection('news').doc(articleId).update({
                                status: 'published',
                                publishedDate: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                        
                        // Refresh data
                        await loadFirestoreData();
                        loadAdminArticles();
                        showCustomAlert('Article approved and published successfully!', 'success');
                        hideLoading();
                        
                    } catch (error) {
                        console.error('Error approving article:', error);
                        showCustomAlert('Error approving article. Please try again.', 'error');
                        hideLoading();
                    }
                }
            );
        }

        async function toggleFeatured(articleId, collection) {
            try {
                showLoading();
                
                const docRef = db.collection(collection).doc(articleId);
                const doc = await docRef.get();
                
                if (doc.exists) {
                    const currentFeatured = doc.data().featured || false;
                    await docRef.update({
                        featured: !currentFeatured
                    });
                    
                    // Refresh data
                    await loadFirestoreData();
                    loadAdminArticles();
                    showCustomAlert(`Article ${!currentFeatured ? 'featured' : 'unfeatured'} successfully!`, 'success');
                }
                
                hideLoading();
                
            } catch (error) {
                console.error('Error toggling featured status:', error);
                showCustomAlert('Error updating article. Please try again.', 'error');
                hideLoading();
            }
        }

        async function deleteAdminArticle(articleId, collection) {
            showConfirmDialog(
                'Delete Article',
                'Are you sure you want to permanently delete this article? This action cannot be undone.',
                async () => {
                    try {
                        showLoading();
                        
                        await db.collection(collection).doc(articleId).delete();
                        
                        // Refresh data
                        await loadFirestoreData();
                        loadAdminArticles();
                        showCustomAlert('Article deleted successfully!', 'success');
                        hideLoading();
                        
                    } catch (error) {
                        console.error('Error deleting article:', error);
                        showCustomAlert('Error deleting article. Please try again.', 'error');
                        hideLoading();
                    }
                },
                'danger'
            );
        }

        async function approvePermissionRequest(requestId, userId, permissionType) {
            showConfirmDialog(
                'Grant Permission',
                `Grant ${permissionType} permission to this user?`,
                async () => {
                    try {
                        showLoading();
                        
                        // Update user permissions
                        const permissionUpdate = {};
                        if (permissionType === 'create') {
                            permissionUpdate.canCreateArticles = true;
                        } else if (permissionType === 'edit') {
                            permissionUpdate.canEditArticles = true;
                        }
                        
                        await db.collection('permissions').doc(userId).update(permissionUpdate);
                        
                        // Delete the request
                        await db.collection('pendingArticles').doc(requestId).delete();
                        
                        loadAdminArticles();
                        showCustomAlert('Permission granted successfully!', 'success');
                        hideLoading();
                        
                    } catch (error) {
                        console.error('Error granting permission:', error);
                        showCustomAlert('Error granting permission. Please try again.', 'error');
                        hideLoading();
                    }
                }
            );
        }

        async function toggleUserVerification(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                const action = user.isVerified ? 'remove verification from' : 'verify';
                showConfirmDialog(
                    'Toggle User Verification',
                    `Are you sure you want to ${action} this user?`,
                    async () => {
                        try {
                            showLoading();
                            
                            await db.collection('users').doc(userId).update({
                                isVerified: !user.isVerified
                            });
                            
                            // Update local data
                            user.isVerified = !user.isVerified;
                            loadAdminUsers();
                            showCustomAlert(`User ${user.isVerified ? 'verified' : 'unverified'} successfully!`, 'success');
                            hideLoading();
                            
                        } catch (error) {
                            console.error('Error updating user verification:', error);
                            showCustomAlert('Error updating user. Please try again.', 'error');
                            hideLoading();
                        }
                    }
                );
            }
        }

        async function suspendUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                const action = user.status === 'suspended' ? 'reactivate' : 'suspend';
                showConfirmDialog(
                    `${action.charAt(0).toUpperCase() + action.slice(1)} User`,
                    `Are you sure you want to ${action} this user?`,
                    async () => {
                        try {
                            showLoading();
                            
                            const newStatus = user.status === 'suspended' ? 'active' : 'suspended';
                            
                            await db.collection('users').doc(userId).update({
                                status: newStatus
                            });
                            
                            // Also update permissions to suspend access
                            if (newStatus === 'suspended') {
                                await db.collection('permissions').doc(userId).update({
                                    isSuspended: true
                                });
                            } else {
                                await db.collection('permissions').doc(userId).update({
                                    isSuspended: false
                                });
                            }
                            
                            // Update local data
                            user.status = newStatus;
                            loadAdminUsers();
                            showCustomAlert(`User ${newStatus === 'suspended' ? 'suspended' : 'reactivated'} successfully!`, 'success');
                            hideLoading();
                            
                        } catch (error) {
                            console.error('Error updating user status:', error);
                            showCustomAlert('Error updating user. Please try again.', 'error');
                            hideLoading();
                        }
                    },
                    user.status === 'suspended' ? 'question' : 'warning'
                );
            }
        }

        async function grantPermission(userId, permission) {
            showConfirmDialog(
                'Grant Permission',
                `Grant ${permission} permission to this user?`,
                async () => {
                    try {
                        showLoading();
                        
                        const permissionUpdate = {};
                        if (permission === 'create') {
                            permissionUpdate.canCreateArticles = true;
                        } else if (permission === 'edit') {
                            permissionUpdate.canEditArticles = true;
                        }
                        
                        await db.collection('permissions').doc(userId).update(permissionUpdate);
                        
                        showCustomAlert('Permission granted successfully!', 'success');
                        hideLoading();
                        
                    } catch (error) {
                        console.error('Error granting permission:', error);
                        showCustomAlert('Error granting permission. Please try again.', 'error');
                        hideLoading();
                    }
                }
            );
        }

        function approveRequest(requestId) {
            showConfirmDialog(
                'Approve Request',
                'Approve this permission request and grant user access?',
                () => {
                    // Update request status in localStorage
                    const requests = JSON.parse(localStorage.getItem('userRequests') || '[]');
                    const request = requests.find(r => r.id === requestId);
                    if (request) {
                        request.status = 'approved';
                        localStorage.setItem('userRequests', JSON.stringify(requests));
                    }
                    
                    loadAdminRequests();
                    updateAdminNotifications();
                    showCustomAlert('Request approved! User permissions updated.', 'success');
                }
            );
        }

        function rejectRequest(requestId) {
            showConfirmDialog(
                'Reject Request',
                'Are you sure you want to reject this permission request?',
                () => {
                    // Update request status in localStorage
                    const requests = JSON.parse(localStorage.getItem('userRequests') || '[]');
                    const request = requests.find(r => r.id === requestId);
                    if (request) {
                        request.status = 'rejected';
                        localStorage.setItem('userRequests', JSON.stringify(requests));
                    }
                    
                    loadAdminRequests();
                    updateAdminNotifications();
                    showCustomAlert('Request rejected.', 'warning');
                },
                'warning'
            );
        }

        // Site settings
        document.getElementById('siteSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('settingSiteTitle').value;
            const tagline = document.getElementById('settingSiteTagline').value;
            const logo = document.getElementById('settingSiteLogo').value;
            
            // Update site elements
            document.getElementById('siteTitle').textContent = title;
            document.getElementById('siteTagline').textContent = tagline;
            if (logo) {
                document.getElementById('siteLogo').src = logo;
            }
            
            alert('Site settings updated!');
        });

        document.getElementById('seoSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const description = document.getElementById('settingMetaDescription').value;
            const keywords = document.getElementById('settingKeywords').value;
            
            // Update meta tags
            document.querySelector('meta[name="description"]').content = description;
            document.querySelector('meta[name="keywords"]').content = keywords;
            
            alert('SEO settings updated!');
        });

        // Custom Alert System
        function showCustomAlert(message, type = 'info', duration = 5000) {
            const alertElement = document.getElementById('customAlert');
            const iconElement = document.getElementById('alertIcon');
            const messageElement = document.getElementById('alertMessage');
            const contentElement = document.getElementById('alertContent');
            
            // Set icon and colors based on type
            switch(type) {
                case 'success':
                    iconElement.className = 'fas fa-check-circle text-2xl text-green-500';
                    contentElement.className = 'max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-green-200 ring-opacity-50 overflow-hidden border-l-4 border-green-500';
                    break;
                case 'error':
                    iconElement.className = 'fas fa-exclamation-circle text-2xl text-red-500';
                    contentElement.className = 'max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-red-200 ring-opacity-50 overflow-hidden border-l-4 border-red-500';
                    break;
                case 'warning':
                    iconElement.className = 'fas fa-exclamation-triangle text-2xl text-yellow-500';
                    contentElement.className = 'max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-yellow-200 ring-opacity-50 overflow-hidden border-l-4 border-yellow-500';
                    break;
                default:
                    iconElement.className = 'fas fa-info-circle text-2xl text-blue-500';
                    contentElement.className = 'max-w-sm w-full bg-white shadow-lg rounded-lg pointer-events-auto ring-1 ring-blue-200 ring-opacity-50 overflow-hidden border-l-4 border-blue-500';
            }
            
            messageElement.textContent = message;
            alertElement.classList.remove('hidden');
            
            // Auto hide after duration
            setTimeout(() => {
                hideCustomAlert();
            }, duration);
        }

        function hideCustomAlert() {
            document.getElementById('customAlert').classList.add('hidden');
        }

        function showConfirmDialog(title, message, onConfirm, type = 'question') {
            const dialog = document.getElementById('confirmDialog');
            const iconElement = document.getElementById('confirmIcon');
            const titleElement = document.getElementById('confirmTitle');
            const messageElement = document.getElementById('confirmMessage');
            const confirmButton = document.getElementById('confirmOk');
            
            // Set icon based on type
            switch(type) {
                case 'danger':
                    iconElement.className = 'fas fa-exclamation-triangle text-4xl mb-4 text-red-500';
                    confirmButton.className = 'flex-1 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700';
                    break;
                case 'warning':
                    iconElement.className = 'fas fa-exclamation-circle text-4xl mb-4 text-yellow-500';
                    confirmButton.className = 'flex-1 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700';
                    break;
                default:
                    iconElement.className = 'fas fa-question-circle text-4xl mb-4 text-blue-500';
                    confirmButton.className = 'flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700';
            }
            
            titleElement.textContent = title;
            messageElement.textContent = message;
            
            confirmButton.onclick = () => {
                hideConfirmDialog();
                if (onConfirm) onConfirm();
            };
            
            dialog.classList.remove('hidden');
        }

        function hideConfirmDialog() {
            document.getElementById('confirmDialog').classList.add('hidden');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function updateAdminNotifications() {
            if (isAdmin) {
                const requests = JSON.parse(localStorage.getItem('userRequests') || '[]');
                const pendingCount = requests.filter(r => r.status === 'pending').length;
                
                if (pendingCount > 0) {
                    document.getElementById('adminNotificationDot').classList.remove('hidden');
                    document.getElementById('adminNotificationCount').classList.remove('hidden');
                    document.getElementById('requestCount').textContent = pendingCount;
                }
            }
        }

        // Utility functions
        function shareArticle() {
            if (navigator.share && currentArticle) {
                navigator.share({
                    title: currentArticle.title,
                    text: currentArticle.summary,
                    url: window.location.href
                });
            } else {
                // Fallback to copying URL
                navigator.clipboard.writeText(window.location.href);
                showCustomAlert('Article URL copied to clipboard!', 'success');
            }
        }

        function bookmarkArticle() {
            showCustomAlert('Article bookmarked! (Feature coming soon)', 'info');
        }

        function showNotifications() {
            showCustomAlert('Notifications feature coming soon!', 'info');
        }

        function showMyArticles() {
            showCustomAlert('My Articles feature coming soon!', 'info');
        }

        function showSettings() {
            showCustomAlert('Settings feature coming soon!', 'info');
        }

        // Prevent zoom - comprehensive approach
        document.addEventListener('wheel', function(e) {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, { passive: false, capture: true });

        document.addEventListener('keydown', function(e) {
            // Prevent Ctrl/Cmd + Plus/Minus/0 for zoom
            if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '-' || e.key === '0' || e.key === '=' || e.keyCode === 187 || e.keyCode === 189 || e.keyCode === 48)) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, { passive: false, capture: true });

        // Prevent pinch zoom on touch devices - more aggressive
        let initialDistance = 0;
        let isZooming = false;

        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
                e.stopPropagation();
                isZooming = true;
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                initialDistance = Math.sqrt(
                    Math.pow(touch2.pageX - touch1.pageX, 2) +
                    Math.pow(touch2.pageY - touch1.pageY, 2)
                );
                return false;
            }
            isZooming = false;
        }, { passive: false, capture: true });

        document.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1 || isZooming) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, { passive: false, capture: true });

        document.addEventListener('touchend', function(e) {
            if (isZooming) {
                e.preventDefault();
                e.stopPropagation();
                isZooming = false;
                return false;
            }
        }, { passive: false, capture: true });

        // Prevent double-tap zoom - more aggressive
        let lastTouchEnd = 0;
        let touchCount = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            touchCount++;
            
            if (now - lastTouchEnd <= 300 && touchCount >= 2) {
                e.preventDefault();
                e.stopPropagation();
                touchCount = 0;
                return false;
            }
            
            setTimeout(() => { touchCount = 0; }, 300);
            lastTouchEnd = now;
        }, { passive: false, capture: true });

        // Prevent gesturestart/gesturechange/gestureend
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }, { passive: false, capture: true });

        document.addEventListener('gesturechange', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }, { passive: false, capture: true });

        document.addEventListener('gestureend', function(e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }, { passive: false, capture: true });

        // Force zoom reset periodically
        setInterval(() => {
            if (window.devicePixelRatio !== 1) {
                document.body.style.zoom = '1';
                document.documentElement.style.zoom = '1';
            }
        }, 100);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d51dc2c3c81bb6',t:'MTc1NDg4Nzg3MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
